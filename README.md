# QTM 실시간 데이터 스트리머 (Real-time Data Streamer for QTM)

Qualisys Track Manager (QTM)에서 실시간으로 6-DoF 리지드 바디(Rigid Body)와 3D 마커(Labeled Marker) 데이터를 스트리밍하여 CSV 파일로 저장하는 파이썬 스크립트입니다. QTM 내에서 별도의 녹화(Capture)를 수행하지 않고 라이브 데이터를 직접 가져오거나, 기존 `.qtm` 파일을 재생하여 데이터를 추출할 수 있습니다.

## 주요 기능 ✨

  - **실시간 스트리밍**: QTM에서 진행 중인 측정을 녹화하지 않고 실시간으로 데이터를 수신합니다.
  - **파일 재생**: 기존 `.qtm` 파일을 재생하여 데이터를 스트리밍하고 저장할 수 있습니다.
  - **데이터 동시 처리**: 6-DoF 리지드 바디와 3D 마커 데이터를 동시에 수집합니다.
  - **자동 CSV 저장**:
      - 각 리지드 바디의 데이터(위치, 회전)는 개별 CSV 파일로 저장됩니다.
      - 모든 마커의 3D 위치 데이터는 하나의 통합된 CSV 파일로 저장됩니다.
  - **데이터 보간**: 스트리밍 중 누락된 프레임이 있을 경우, 자동으로 선형 보간하여 빈 데이터를 채워줍니다.
  - **간편한 종료**: `Ctrl+C`를 누르면 데이터 수집을 안전하게 중단하고 즉시 저장합니다.

## 시스템 요구사항 💻

  - **소프트웨어**:
      - Qualisys Track Manager (QTM)
      - Python 3.8 이상
  - **Python 라이브러리**:
      - `qtm-rt`
      - `pandas`
      - `scipy`

## 설치 방법 🛠️

1.  **Python 라이브러리 설치**

    아래 명령어를 터미널 또는 명령 프롬프트에 입력하여 필요한 라이브러리를 설치하세요.

    ```bash
    pip install qtm-rt pandas scipy
    ```

2.  **QTM 설정 확인**

      - QTM을 실행하고, 데이터를 받을 프로젝트를 엽니다.
      - `Project Options` \> `Output` \> `Real-time server` 항목을 활성화(Enable)합니다.
      - `Password`가 설정되어 있다면, 스크립트에서 사용해야 하므로 기억해두세요.

## 사용 방법 🚀

1.  **스크립트 설정**

    `stream_6dof_JK_Final.py` 파일을 열어 아래 `사용자 설정` 부분을 자신의 환경에 맞게 수정합니다.

    ```python
    # ────────── 사용자 설정 ──────────
    # .qtm 파일을 재생하려면 파일 경로를 입력하고, 실시간 스트리밍을 원하면 None으로 두세요.
    QTM_FILE     = None

    # QTM이 실행 중인 컴퓨터의 IP 주소를 입력하세요 (동일 컴퓨터면 "127.0.0.1").
    QTM_IP       = "127.0.0.1"

    # QTM Real-time server에 설정한 비밀번호를 입력하세요.
    QTM_PASSWORD = "password"

    # 특정 리지드 바디 하나만 저장하려면 이름을 입력하고, 모두 저장하려면 None으로 두세요.
    WANTED_BODY  = None
    # ──────────────────────
    ```

2.  **스크립트 실행**

    터미널에서 아래 명령어로 스크립트를 실행합니다.

    ```bash
    python stream_6dof_JK_Final.py
    ```

3.  **데이터 수집 및 저장**

      - 스크립트가 실행되면 "📡 실시간 스트리밍 시작..." 또는 "▶ ... 파일 재생 중..." 메시지가 나타나며 데이터 수집을 시작합니다.
      - 데이터 수집을 중단하고 싶을 때 터미널에서 `Ctrl + C`를 누릅니다.
      - "🛑 종료 – 저장중…" 메시지와 함께 수집된 데이터가 CSV 파일로 자동 저장됩니다.

## 출력 파일 📂

  - 스크립트를 실행하면 바탕화면에 `qtm_export_YYYYMMDD_HHMMSS` 형식의 폴더가 생성됩니다.
  - 생성된 폴더 안에 데이터가 저장됩니다.

#### 리지드 바디 CSV (`<바디이름>.csv`)

각 리지드 바디에 대해 개별 파일이 생성됩니다.

  - **포맷**:
      - 파일 상단에 측정 시작 및 종료 시간이 `#` 주석으로 기록됩니다.
      - `Frame`: 프레임 번호
      - `Pos_X`, `Pos_Y`, `Pos_Z`: 월드 좌표계 기준 위치 (mm)
      - `Roll`, `Pitch`, `Yaw`: 오일러 각도 회전 (degree)

#### 마커 CSV (`markers.csv`)

모든 마커의 데이터가 하나의 파일에 통합되어 저장됩니다.

  - **포맷**:
      - 파일 상단에 측정 시작 및 종료 시간이 `#` 주석으로 기록됩니다.
      - `Frame`: 프레임 번호
      - `<마커이름>_Pos_X`, `<마커이름>_Pos_Y`, `<마커이름>_Pos_Z`: 각 마커의 3D 위치 (mm)

-----
